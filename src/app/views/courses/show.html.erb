<% if !@course.approved? %>
<div class="alert alert-info">
  <% if can? :approve, @course %>
  <%= link_to 'approve course', approve_course_path(@course), class: 'btn btn-success' %>
  <%= link_to 'delete course', @course, class: 'btn btn-danger', confirm: 'Are you sure that you want to delete this course?', method: :delete %>
  <% end %>
  This course was suggested and will be checked by our moderators. You can still interact with this course like with approved courses. 
</div>
<% end %>

<div class="hero-unit">
  <h2>
    <%= " #{@course.name.titleize}" %>
    <small><%= "(#{@course.term.code})" %></small>
  </h2>
  <% unless @course.description.nil? or @course.description.empty? %>
      <p class="lead"><%= markdown(@course.description) %></p>
    <% end %>
</div>
<div class="row">
  <div class="span4">
    <h3>About</h3>
    <dl class="dl-horizontal">
      <dt>Course Website</dt>
      <dd><%= link_to @course.url, @course.url %></dt></dd> 
    </dl>

    <dl class="dl-horizontal">
        <dt><%= pluralize(@course.maintainers.count, 'maintainer') %></dt>
        <dd>
          <% if @course.maintainers.empty? %>
            <%= link_to "I'm lecturer of this course", maintainer_request_path, class: 'btn btn-mini btn-primary' %>
          <% else %>
            <% @course.maintainers.each do |maintainer| %>
              <% if !maintainer.user.nil? %>
                <dd><%= maintainer.user.full_name %></dd>
              <% end %>
            <% end %>
          <% end %>
        </dd>
      <% if current_user && current_user.may_edit_course(@course) && !@course.editors.empty? %>
        <dt><%= pluralize(@course.editors.count, 'editor') %></dt>
          <% @course.editors.each do |editor| %>
            <% if !editor.user.nil? %>
              <dd><%= editor.user.full_name %></dd>
            <% end %>
          <% end %>
      <% end %>
    </dl>
  </div>
  <div class="span4">
    <h3>What's new?</h3>
  </div>
  <div class="span4">
    <h3>Maintainer actions</h3>
      <%= link_to content_tag('span', ' manage users', :class=> 'icon-user'), '#manage-users-modal', 'data-toggle'=>"modal"%>
  </div>
</div>


<header class="hero-unit">
  
  <div class="row-fluid">
    <div class="span10">
      <h2>
        <% if @course.lecture and @course.previous %>
          <small>
            <%= link_to content_tag('i', '', :class=>'icon-chevron-left'), @course.previous, :rel=>"tooltip", 'data-original-title'=>"Go to the previous semester", :id => 'previous-course' %>
          </small>
        <% else %>
          <small>
            <%= link_to content_tag('i', '', :class=>'icon-chevron-left'), '#', :rel=>"tooltip", 'data-original-title'=>"Not available yet", :id => 'previous-course' %>
          </small>
        <% end %>
    
        <%= " #{@course.name.titleize}" %>
        <small><%= "(#{@course.term.code})" %></small> 

        <% if @course.lecture and @course.next %>
          <small>
            <%= link_to content_tag('i', '', :class=>'icon-chevron-right'), @course.next, :rel=>"tooltip", 'data-original-title'=>"Go to the next semester", :id => 'next-course' %>
          </small>
        <% else %>
           <small><%= link_to content_tag('i', '', :class=>'icon-chevron-right'), '#', :rel=>"tooltip", 'data-original-title'=>"Not available yet", :id => 'next-course' %>
           </small>
        <% end %>

      </h2>
      <div class='<%= "follow-button follow-button-#{@course.id}" %>'><%= render :partial => 'shared/follow_button', :locals => { :course => @course } %></div>
    </div>
    <div class="span2">
      <%= render :partial => 'courses/maintain_dropdown', :locals => {:course => @course } %>
    </div>  
  </div>
  
  <blockquote cite="<%= url_for @course.url if !@course.url.nil? %>">
    <% unless @course.description.nil? or @course.description.empty? %>
      <p class="lead"><%= markdown(@course.description) %></p>
    <% end %>
  </blockquote>

  <dl class="dl-horizontal">
    
    <% if @course.lecture %>
    <dt>all courses</dt>

    <dd> <%= link_to "list of all courses of this lecture ", :controller => "lectures", :action => "show", :id => @course.lecture.id, :noredirect => true %> </dd>
    
    <%= render :partial => 'courses/maintainer_list', :locals => {:maintainers => @course.maintainers, :editors => @course.editors, :course => @course }%>

    <% unless @course.lecture.chair.url.nil? or @course.lecture.chair.url.empty? %>
      <dt>chair website</dt>
      <dd> <%= link_to @course.lecture.chair.url, @course.lecture.chair.url%> </dd>
    <% end %>

    <% unless @course.lecture.url.nil? or @course.lecture.url.empty? %>
      <dt>lecture website</dt>
      <dd> <%= link_to @course.lecture.url, @course.lecture.url%> </dd>
    <% end %>
    <% end %>

    <% unless @course.url.nil? or @course.url.empty? %>
      <dt>course website</dt>
      <dd> <%= link_to @course.url, @course.url %> </dd>
    <% end %>
  </dl>
</header>

<%= render :partial => 'courses/manage_users_modal', :locals => { :course => @course }%>


<section id="announcement_stream">
  <div class="center span8">
      <h3>
        Course announcements 
        <% if current_user and current_user.may_edit_course(@course) %>
         <small><%= link_to 'New announcement', new_post_path(:post_type => 'info', :course_id => @course.id), :class => 'inline-button btn btn-mini btn-warning' %></small>
        <% end %>
        <p class="pull-right"><small>sorted by last activity</small></p>
        <hr />
      </h3>  
    <div id="announcement-stream">
      <%= render 'courses/announcement_stream'%>
    </div>
  </div>
</section>

<br />

<section id="question_stream">
  <div class="center span8">
      <h3>
        Questions?
        <% if user_signed_in? %>
          <small>
            <%= link_to 'Ask a public question', new_post_path(:post_type => 'question', :course_id => @course.id), :class => 'inline-button btn btn-mini btn-primary' %>
            <%= link_to 'Ask moderators (private question)', new_post_path(:post_type => 'question', :course_id => @course.id, :is_private => true), class: 'inline-button btn btn-mini' %>
          </small>
        <% end %>
        <p class="pull-right"><small>sorted by last activity</small></p>
        <hr />
        
      </h3>
    <div id="question-stream">
      <%= render 'courses/question_stream' %>
    </div>
  </div>
</section>

  
